---
title: "Introducción a Django (2ª parte)"
---

## Estructura de una aplicación Django

Si queremos desarrollar un proyecto Django desde 0 tenemos que generar los ficheros del proyecto, para ello debemos ejecutar:

```
(django)$ django-admin startproject mysite
```

Eso creará un directorio `mysite` con nuestro proyecto Django que acabamos de crear.

**Nosotros no vamos a ejecutar ese comando porque partimos de un proyecto Django ya construido**. En nuestro caso nuestra aplicación está en el repositorio Django **Guestbook**: [https://github.com/josedom24/guestbook_django](https://github.com/josedom24/guestbook_django).

La estructura general de un proyecto Django es la siguiente:

``` 
guestbook_project/
├── manage.py
├── guestbook_project/
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py
│   ├── wsgi.py
│   └── asgi.py
```

* `manage.py`: La utilidad de terminal que vamos a usar para manejar nuestra aplicación.
* El directorio `guestbook_project` es un paquete python (agrupa distintos módulos (ficheros python)). Esto se indica con un fichero vacío que se de be llamar `__init__.py`.
* `settings.py`: La configuración de la aplicación.
* `urls.py`: Donde se declaran las rutas que va tener la aplicación.
* `wsgi.py`: Fichero wsgi para el despliegue de la aplicación utilizando el protocolo wsgi.
* `asgi.py`: Fichero asgi para el despliegue de la aplicación utilizando el protocolo asgi.

## Aplicaciones en un proyecto Django

Ya tenemos un proyecto Django construido. Ahora tenemos que darle funcionalidad. Cada una de las funcionalidades de un proyecto Django se llama **aplicación**. Por ejemplo un proyecto Django de gestión puede tener una aplicación de clientes, otra de pedidos, otra de presupuestos,...

Por defecto nuestro proyecto Django ya tiene algunas aplicaciones configuradas:

* `admin`: Panel administrativo que nos permite manejar la base de datos de nuestra aplicación.
* `auth`: Aplicación que me permite trabajar con usuarios en mi proyecto.
* ...

Además de las aplicaciones por defecto, el programador deberá añadir las aplicaciones adicionales para que el proyecto ofrezca distintas funcionalidades. En nuestro ejemplo, tenemos una aplicación llamada **guestbook** que nos permite gestionar un libro de visita, donde podemos poner comentarios que se irán guardando en una base de datos. La aplicación **guestbook se encuentra en el directorio `guestbook`:


```
guestbook_project/
├── manage.py
├── guestbook_project/
│   ├── __init__.py
│   ├── settings.py
│   ├── urls.py
│   ├── wsgi.py
│   └── asgi.py
├── guestbook/
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── forms.py
│   ├── models.py
│   ├── urls.py
│   ├── views.py
│   └── templates/
│       └── inicio.html
├── static/
│   └── style.css
└── requirements.txt
```

## La configuración del proyecto

Veamos el ficheros `settings.py` que encontramos dentro del directorio `guestbook_project`:

* `DEBUG = True`: Si está activo los errores que se produzcan en la aplicación se verán con todo lujo de detalles en el navegador. Si tenemos la aplicación en producción debería ser `False`.
* `ALLOWED_HOSTS = []`: Una lista con los nombres con los que se va a permitir el acceso a la aplicación.
* `INSTALLED_APPS = [...]`: La lista de las aplicaciones que tiene instalada el proyecto.
* `DATABASES`: Configuración de la base de datos que se va a utilizar en el proyecto. Por defecto se utiliza una base de datos sqlite llamada `db.sqlite3`.

## El modelo de la aplicación

Django incluye un **ORM (Object Relational Mapper)**, un sistema que permite trabajar con la base de datos usando objetos Python en lugar de sentencias SQL.

El modelo nos permite diseñar las tablas y las relaciones con la que vamos a trabajar en nuestra aplicación. El modelo de Django nos **independiza del motor de base de datos**, es decir, vamos a trabajar con clases y objetos que representan los datos y nos da igual que los datos se guarden en cualquier tipo de base de datos.

El modelo de la aplicación `guestbook` se define en el fichero `guestbook/models.py`:

```
from django.db import models

class Entry(models.Model):
    content = models.CharField(max_length=255)
    created_at = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return self.content
```
Cada **clase** representa una **tabla** y la definición de sus **atributos**.

Se crea una clase llamada `Entry`. Si creamos objetos de esta clase en el programa podremos gestionar los datos de una tabla dentro de la base de datos que hemos configurado en el proyecto. 

La tabla tendrá tres campos:

* Un `id` autoincremental, que no hemos indicado.
* `content`: Cadena de caracteres con longitud 255, donde se guarda el mensaje.
* `created_at`: De tipo fecha/Hora que guarda la fecha y la hora de creación del comentario-

Con los objetos de la clase `Entry` podremos insertar, modificar, eliminar, consultar, ... los registros de la tabla.

**¿Qué relación tiene el modelo con la base de datos que hemos configurado en el fichero `settings.py`?**
El programa va a trabajar para gestionar los datos con los objetos de esta clase, pero cada vez que se haga una operación en los datos se traducirá internamente a SQL para que se guarde en la base de datos configurada.

## Migraciones

Las **migraciones** son el mecanismo mediante el cual Django traduce los modelos Python a tablas reales en la base de datos.

Tenemos que trasladar a la base de datos configurada, las tablas que hemos representado con clases en el modelo.

Para ello usamos las **migraciones** que son ficheros con las instrucciones necesarias para que Django 